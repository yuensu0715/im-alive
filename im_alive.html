<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0d1f0d">
<title>ë‚˜ ì‚´ì•„ìˆì–´</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a1a0a;
    --bg2: #0f240f;
    --green: #4caf50;
    --green2: #81c784;
    --green-glow: rgba(76,175,80,0.3);
    --red: #e53935;
    --yellow: #ffb300;
    --text: #e8f5e9;
    --text-muted: #6a9a6a;
    --border: #1e3a1e;
    --surface: #112011;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    min-height: 100vh;
    min-height: -webkit-fill-available;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
  }

  /* ë°°ê²½ pulse íš¨ê³¼ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse at 50% 40%, rgba(76,175,80,0.06) 0%, transparent 70%);
    pointer-events: none;
    animation: bgPulse 4s ease-in-out infinite;
  }

  @keyframes bgPulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
  }

  /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
  .tab-bar {
    position: fixed;
    bottom: 0;
    left: 0; right: 0;
    background: rgba(10,26,10,0.95);
    backdrop-filter: blur(10px);
    border-top: 1px solid var(--border);
    display: flex;
    z-index: 100;
    padding-bottom: env(safe-area-inset-bottom);
  }

  .tab {
    flex: 1;
    padding: 12px 0;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
    background: none;
    color: var(--text-muted);
    font-family: 'Noto Sans KR', sans-serif;
  }

  .tab.active { color: var(--green); }

  .tab-icon { font-size: 22px; display: block; margin-bottom: 3px; }
  .tab-label { font-size: 10px; letter-spacing: 0.5px; }

  /* í˜ì´ì§€ */
  .page {
    display: none;
    width: 100%;
    max-width: 480px;
    padding: 0 20px 100px;
    padding-top: max(40px, env(safe-area-inset-top));
    min-height: 100vh;
    flex-direction: column;
    align-items: center;
  }

  .page.active { display: flex; }

  /* ë©”ì¸ í˜ì´ì§€ */
  .app-title {
    font-size: 13px;
    color: var(--text-muted);
    letter-spacing: 3px;
    margin-bottom: 40px;
    margin-top: 10px;
  }

  /* ìƒíƒœ ë§ */
  .status-ring {
    position: relative;
    width: 220px;
    height: 220px;
    margin-bottom: 32px;
  }

  .status-ring svg {
    position: absolute;
    inset: 0;
    transform: rotate(-90deg);
  }

  .ring-bg { fill: none; stroke: var(--border); stroke-width: 8; }
  .ring-progress {
    fill: none;
    stroke: var(--green);
    stroke-width: 8;
    stroke-linecap: round;
    stroke-dasharray: 628;
    stroke-dashoffset: 628;
    transition: stroke-dashoffset 1s ease, stroke 0.5s ease;
    filter: drop-shadow(0 0 6px var(--green));
  }

  .ring-center {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .ring-emoji { font-size: 48px; margin-bottom: 6px; }

  .ring-time {
    font-size: 28px;
    font-weight: 900;
    color: var(--green2);
    letter-spacing: -1px;
    line-height: 1;
  }

  .ring-label {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 4px;
    letter-spacing: 1px;
  }

  /* ë©”ì¸ ë²„íŠ¼ */
  .alive-btn {
    width: 100%;
    max-width: 320px;
    padding: 22px;
    background: var(--green);
    border: none;
    border-radius: 20px;
    font-size: 22px;
    font-weight: 900;
    font-family: 'Noto Sans KR', sans-serif;
    color: #000;
    cursor: pointer;
    transition: all 0.15s;
    letter-spacing: 1px;
    box-shadow: 0 0 30px var(--green-glow), 0 4px 20px rgba(0,0,0,0.5);
    position: relative;
    overflow: hidden;
    margin-bottom: 16px;
  }

  .alive-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.1);
    opacity: 0;
    transition: opacity 0.2s;
  }

  .alive-btn:active::before { opacity: 1; }
  .alive-btn:active { transform: scale(0.97); }

  .alive-btn.pressed {
    animation: btnPress 0.6s ease;
  }

  @keyframes btnPress {
    0% { transform: scale(1); }
    30% { transform: scale(0.93); box-shadow: 0 0 60px var(--green-glow); }
    100% { transform: scale(1); }
  }

  .status-info {
    font-size: 13px;
    color: var(--text-muted);
    text-align: center;
    line-height: 1.7;
  }

  .status-info strong { color: var(--green2); }

  /* ê²½ê³  ë°°ë„ˆ */
  .warn-banner {
    width: 100%;
    max-width: 320px;
    background: rgba(229,57,53,0.1);
    border: 1px solid rgba(229,57,53,0.4);
    border-radius: 12px;
    padding: 14px 16px;
    margin-bottom: 16px;
    font-size: 13px;
    color: #ef9a9a;
    line-height: 1.7;
    text-align: center;
    display: none;
  }

  .warn-banner.visible { display: block; }

  /* ì—°ë½ì²˜ í˜ì´ì§€ */
  .page-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 6px;
    align-self: flex-start;
  }

  .page-sub {
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 24px;
    align-self: flex-start;
    line-height: 1.6;
  }

  .contact-card {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 12px;
  }

  .contact-card label {
    font-size: 11px;
    color: var(--text-muted);
    letter-spacing: 1px;
    display: block;
    margin-bottom: 8px;
  }

  .contact-card input {
    width: 100%;
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 15px;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.2s;
    margin-bottom: 8px;
  }

  .contact-card input:focus { border-color: var(--green); }
  .contact-card input:last-child { margin-bottom: 0; }

  .btn-save {
    width: 100%;
    background: var(--green);
    border: none;
    border-radius: 12px;
    padding: 14px;
    font-size: 15px;
    font-weight: 700;
    font-family: 'Noto Sans KR', sans-serif;
    color: #000;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
  }

  .btn-save:active { transform: scale(0.97); }

  .save-ok {
    text-align: center;
    font-size: 12px;
    color: var(--green2);
    margin-top: 8px;
    display: none;
  }

  /* ì„¤ì • í˜ì´ì§€ */
  .setting-row {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 16px 18px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .setting-label { font-size: 14px; color: var(--text); }
  .setting-sub { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

  .toggle {
    width: 48px;
    height: 28px;
    background: var(--border);
    border-radius: 14px;
    position: relative;
    cursor: pointer;
    transition: background 0.3s;
    flex-shrink: 0;
  }

  .toggle.on { background: var(--green); }

  .toggle::after {
    content: '';
    position: absolute;
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 50%;
    top: 3px;
    left: 3px;
    transition: transform 0.3s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }

  .toggle.on::after { transform: translateX(20px); }

  select.setting-select {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px;
    padding: 6px 10px;
    outline: none;
  }

  /* ê¸°ë¡ í˜ì´ì§€ */
  .log-item {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .log-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--green);
    flex-shrink: 0;
    box-shadow: 0 0 6px var(--green);
  }

  .log-dot.missed { background: var(--red); box-shadow: 0 0 6px var(--red); }

  .log-text { font-size: 13px; color: var(--text); }
  .log-time { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

  .empty-log {
    text-align: center;
    color: var(--text-muted);
    font-size: 13px;
    padding: 40px 0;
    line-height: 2;
  }

  /* ì„±ê³µ íŒŒí‹°í´ */
  .particle {
    position: fixed;
    pointer-events: none;
    font-size: 24px;
    animation: particleFly 1s ease-out forwards;
    z-index: 999;
  }

  @keyframes particleFly {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-120px) scale(0.5); opacity: 0; }
  }
</style>
</head>
<body>

<!-- ë©”ì¸ í˜ì´ì§€ -->
<div class="page active" id="page-main">
  <div class="app-title">ë‚˜ ì‚´ì•„ìˆì–´ ğŸ’š</div>

  <div class="status-ring">
    <svg viewBox="0 0 220 220">
      <circle class="ring-bg" cx="110" cy="110" r="100"/>
      <circle class="ring-progress" id="ringProgress" cx="110" cy="110" r="100"/>
    </svg>
    <div class="ring-center">
      <div class="ring-emoji" id="ringEmoji">ğŸ˜Š</div>
      <div class="ring-time" id="ringTime">--:--</div>
      <div class="ring-label" id="ringLabel">ë§ˆì§€ë§‰ í™•ì¸</div>
    </div>
  </div>

  <div class="warn-banner" id="warnBanner">
    âš ï¸ í™•ì¸ì´ ì§€ì—°ë˜ê³  ìˆì–´ìš”!<br>
    <strong>ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</strong>
  </div>

  <button class="alive-btn" id="aliveBtn" onclick="pressAlive()">
    ğŸ’š ë‚˜ ì‚´ì•„ìˆì–´!
  </button>

  <div class="status-info" id="statusInfo">
    ë²„íŠ¼ì„ ë§¤ì¼ í•œ ë²ˆì”© ëˆŒëŸ¬ì£¼ì„¸ìš”.<br>
    <strong>24ì‹œê°„</strong> ë‚´ ë¯¸ì…ë ¥ ì‹œ ë³´í˜¸ìì—ê²Œ ì•Œë¦¼ì´ ê°€ìš”.
  </div>
</div>

<!-- ì—°ë½ì²˜ í˜ì´ì§€ -->
<div class="page" id="page-contact">
  <div class="page-title">ë³´í˜¸ì ì—°ë½ì²˜</div>
  <div class="page-sub">24ì‹œê°„ ë‚´ í™•ì¸ì´ ì—†ìœ¼ë©´<br>ì•„ë˜ ì—°ë½ì²˜ë¡œ ë¬¸ì ë©”ì‹œì§€ê°€ ë°œì†¡ë¼ìš”.</div>

  <div class="contact-card">
    <label>ë³´í˜¸ì 1</label>
    <input type="text" id="c1name" placeholder="ì´ë¦„ (ì˜ˆ: ë”¸ ê¹€ë¯¼ì§€)" maxlength="20">
    <input type="tel" id="c1phone" placeholder="ì „í™”ë²ˆí˜¸ (ì˜ˆ: 010-1234-5678)" maxlength="20">
  </div>

  <div class="contact-card">
    <label>ë³´í˜¸ì 2</label>
    <input type="text" id="c2name" placeholder="ì´ë¦„ (ì˜ˆ: ì•„ë“¤ ê¹€ì² ìˆ˜)" maxlength="20">
    <input type="tel" id="c2phone" placeholder="ì „í™”ë²ˆí˜¸" maxlength="20">
  </div>

  <div class="contact-card">
    <label>ë³´í˜¸ì 3</label>
    <input type="text" id="c3name" placeholder="ì´ë¦„" maxlength="20">
    <input type="tel" id="c3phone" placeholder="ì „í™”ë²ˆí˜¸" maxlength="20">
  </div>

  <div class="contact-card">
    <label>ë³´í˜¸ì 4</label>
    <input type="text" id="c4name" placeholder="ì´ë¦„" maxlength="20">
    <input type="tel" id="c4phone" placeholder="ì „í™”ë²ˆí˜¸" maxlength="20">
  </div>

  <div class="contact-card">
    <label>ë³´í˜¸ì 5</label>
    <input type="text" id="c5name" placeholder="ì´ë¦„" maxlength="20">
    <input type="tel" id="c5phone" placeholder="ì „í™”ë²ˆí˜¸" maxlength="20">
  </div>

  <div class="contact-card" style="margin-top:8px;">
    <label>ë‚´ ì´ë¦„ (ì•Œë¦¼ ë©”ì‹œì§€ì— í‘œì‹œ)</label>
    <input type="text" id="myName" placeholder="ì˜ˆ: í™ê¸¸ë™" maxlength="10">
  </div>

  <button class="btn-save" onclick="saveContacts()">ì €ì¥í•˜ê¸°</button>
  <div class="save-ok" id="saveOk">âœ… ì €ì¥ëì–´ìš”!</div>
</div>

<!-- ê¸°ë¡ í˜ì´ì§€ -->
<div class="page" id="page-log">
  <div class="page-title">í™•ì¸ ê¸°ë¡</div>
  <div class="page-sub" style="margin-bottom:20px;">ìµœê·¼ 30ì¼ í™•ì¸ ê¸°ë¡ì´ì—ìš”.</div>
  <div id="logList" style="width:100%;"></div>
</div>

<!-- ì„¤ì • í˜ì´ì§€ -->
<div class="page" id="page-setting">
  <div class="page-title">ì„¤ì •</div>
  <div class="page-sub" style="margin-bottom:20px;">ì•Œë¦¼ ë° ì•± ì„¤ì •</div>

  <div class="setting-row">
    <div>
      <div class="setting-label">ì•Œë¦¼ ì‹œê°„</div>
      <div class="setting-sub">ë§¤ì¼ ì´ ì‹œê°„ì— í™•ì¸ ì•Œë¦¼ì„ ë°›ì•„ìš”</div>
    </div>
    <select class="setting-select" id="alarmTime">
      <option value="8">ì˜¤ì „ 8ì‹œ</option>
      <option value="9" selected>ì˜¤ì „ 9ì‹œ</option>
      <option value="10">ì˜¤ì „ 10ì‹œ</option>
      <option value="12">ë‚® 12ì‹œ</option>
      <option value="18">ì˜¤í›„ 6ì‹œ</option>
      <option value="20">ì˜¤í›„ 8ì‹œ</option>
    </select>
  </div>

  <div class="setting-row">
    <div>
      <div class="setting-label">ê²½ê³  ì•Œë¦¼</div>
      <div class="setting-sub">20ì‹œê°„ ê²½ê³¼ ì‹œ ë¯¸ë¦¬ ê²½ê³ </div>
    </div>
    <div class="toggle on" id="warnToggle" onclick="this.classList.toggle('on')"></div>
  </div>

  <div class="setting-row" style="flex-direction:column; align-items:flex-start; gap:10px;">
    <div>
      <div class="setting-label">ì•± ì •ë³´</div>
      <div class="setting-sub">ë‚˜ ì‚´ì•„ìˆì–´ v1.0 â€” ê³ ë…ì‚¬ ì˜ˆë°© ì•±</div>
      <div class="setting-sub">ì œì‘ì: yuensu0715</div>
      <div class="setting-sub">ì œì‘ì¼: 2026ë…„ 2ì›” 23ì¼</div>
    </div>
  </div>

  <div class="setting-row" style="cursor:pointer;" onclick="clearAll()">
    <div>
      <div class="setting-label" style="color:#ef9a9a;">ë°ì´í„° ì´ˆê¸°í™”</div>
      <div class="setting-sub">ëª¨ë“  ê¸°ë¡ê³¼ ì„¤ì •ì„ ì‚­ì œí•´ìš”</div>
    </div>
    <span style="color:var(--text-muted); font-size:18px;">â€º</span>
  </div>
</div>

<!-- íƒ­ ë°” -->
<div class="tab-bar">
  <button class="tab active" onclick="showPage('main', this)">
    <span class="tab-icon">ğŸ’š</span>
    <span class="tab-label">í™•ì¸</span>
  </button>
  <button class="tab" onclick="showPage('contact', this)">
    <span class="tab-icon">ğŸ‘¥</span>
    <span class="tab-label">ì—°ë½ì²˜</span>
  </button>
  <button class="tab" onclick="showPage('log', this)">
    <span class="tab-icon">ğŸ“‹</span>
    <span class="tab-label">ê¸°ë¡</span>
  </button>
  <button class="tab" onclick="showPage('setting', this)">
    <span class="tab-icon">âš™ï¸</span>
    <span class="tab-label">ì„¤ì •</span>
  </button>
</div>

<script>
// í˜ì´ì§€ ì „í™˜
function showPage(name, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  el.classList.add('active');

  if (name === 'log') renderLog();
  if (name === 'contact') loadContacts();
}

// ë°ì´í„°
function getData() {
  return JSON.parse(localStorage.getItem('alive_data') || '{"lastCheck":null,"log":[]}');
}

function saveData(d) {
  localStorage.setItem('alive_data', JSON.stringify(d));
}

// ë‚˜ ì‚´ì•„ìˆì–´ ë²„íŠ¼
function pressAlive() {
  const btn = document.getElementById('aliveBtn');
  btn.classList.add('pressed');
  setTimeout(() => btn.classList.remove('pressed'), 600);

  const now = new Date();
  const d = getData();
  d.lastCheck = now.toISOString();
  d.log = d.log || [];
  d.log.unshift({ time: now.toISOString(), type: 'check' });
  if (d.log.length > 60) d.log = d.log.slice(0, 60);
  saveData(d);

  // íŒŒí‹°í´
  spawnParticles();
  updateUI();
}

function spawnParticles() {
  const emojis = ['ğŸ’š','âœ¨','ğŸŒŸ','ğŸ’«','ğŸŸ¢'];
  const btn = document.getElementById('aliveBtn');
  const rect = btn.getBoundingClientRect();
  for (let i = 0; i < 6; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    p.style.left = (rect.left + Math.random() * rect.width) + 'px';
    p.style.top = (rect.top) + 'px';
    p.style.animationDelay = (Math.random() * 0.3) + 's';
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 1200);
  }
}

// UI ì—…ë°ì´íŠ¸
function updateUI() {
  const d = getData();
  const ring = document.getElementById('ringProgress');
  const timeEl = document.getElementById('ringTime');
  const labelEl = document.getElementById('ringLabel');
  const emojiEl = document.getElementById('ringEmoji');
  const warnBanner = document.getElementById('warnBanner');
  const statusInfo = document.getElementById('statusInfo');

  if (!d.lastCheck) {
    ring.style.strokeDashoffset = 628;
    timeEl.textContent = '--';
    labelEl.textContent = 'ì•„ì§ í™•ì¸ ì•ˆ í•¨';
    emojiEl.textContent = 'ğŸ˜´';
    return;
  }

  const last = new Date(d.lastCheck);
  const now = new Date();
  const elapsed = (now - last) / 1000 / 60 / 60; // ì‹œê°„
  const remaining = 24 - elapsed;

  // ë§ ì§„í–‰ë„ (ë‚¨ì€ ì‹œê°„ ê¸°ì¤€)
  const progress = Math.max(0, Math.min(1, remaining / 24));
  const offset = 628 * (1 - progress);
  ring.style.strokeDashoffset = offset;

  // ìƒ‰ìƒ
  if (remaining < 4) {
    ring.style.stroke = '#e53935';
    ring.style.filter = 'drop-shadow(0 0 6px #e53935)';
    emojiEl.textContent = 'ğŸ˜°';
  } else if (remaining < 8) {
    ring.style.stroke = '#ffb300';
    ring.style.filter = 'drop-shadow(0 0 6px #ffb300)';
    emojiEl.textContent = 'ğŸ˜';
  } else {
    ring.style.stroke = '#4caf50';
    ring.style.filter = 'drop-shadow(0 0 6px #4caf50)';
    emojiEl.textContent = 'ğŸ˜Š';
  }

  if (remaining <= 0) {
    timeEl.textContent = 'ì´ˆê³¼!';
    labelEl.textContent = 'í™•ì¸ í•„ìš”';
    emojiEl.textContent = 'ğŸš¨';
    warnBanner.classList.add('visible');
  } else {
    const h = Math.floor(remaining);
    const m = Math.floor((remaining - h) * 60);
    timeEl.textContent = `${h}ì‹œê°„ ${m}ë¶„`;
    labelEl.textContent = 'ë‚¨ì€ ì‹œê°„';
    warnBanner.classList.toggle('visible', elapsed > 20);
  }

  // ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„
  const hh = last.getHours().toString().padStart(2,'0');
  const mm = last.getMinutes().toString().padStart(2,'0');
  const mo = (last.getMonth()+1).toString().padStart(2,'0');
  const dd = last.getDate().toString().padStart(2,'0');
  statusInfo.innerHTML = `ë§ˆì§€ë§‰ í™•ì¸: <strong>${mo}ì›” ${dd}ì¼ ${hh}:${mm}</strong><br>24ì‹œê°„ ë‚´ ë¯¸ì…ë ¥ ì‹œ ë³´í˜¸ìì—ê²Œ ì•Œë¦¼ì´ ê°€ìš”.`;
}

// ì—°ë½ì²˜ ì €ì¥/ë¡œë“œ
function saveContacts() {
  const contacts = {
    myName: document.getElementById('myName').value,
    c1: { name: document.getElementById('c1name').value, phone: document.getElementById('c1phone').value },
    c2: { name: document.getElementById('c2name').value, phone: document.getElementById('c2phone').value },
    c3: { name: document.getElementById('c3name').value, phone: document.getElementById('c3phone').value },
    c4: { name: document.getElementById('c4name').value, phone: document.getElementById('c4phone').value },
    c5: { name: document.getElementById('c5name').value, phone: document.getElementById('c5phone').value },
  };
  localStorage.setItem('alive_contacts', JSON.stringify(contacts));
  const ok = document.getElementById('saveOk');
  ok.style.display = 'block';
  setTimeout(() => ok.style.display = 'none', 2000);
}

function loadContacts() {
  const c = JSON.parse(localStorage.getItem('alive_contacts') || '{}');
  if (c.myName) document.getElementById('myName').value = c.myName;
  if (c.c1) { document.getElementById('c1name').value = c.c1.name || ''; document.getElementById('c1phone').value = c.c1.phone || ''; }
  if (c.c2) { document.getElementById('c2name').value = c.c2.name || ''; document.getElementById('c2phone').value = c.c2.phone || ''; }
  if (c.c3) { document.getElementById('c3name').value = c.c3.name || ''; document.getElementById('c3phone').value = c.c3.phone || ''; }
  if (c.c4) { document.getElementById('c4name').value = c.c4.name || ''; document.getElementById('c4phone').value = c.c4.phone || ''; }
  if (c.c5) { document.getElementById('c5name').value = c.c5.name || ''; document.getElementById('c5phone').value = c.c5.phone || ''; }
}

// ê¸°ë¡ ë Œë”ë§
function renderLog() {
  const d = getData();
  const list = document.getElementById('logList');

  if (!d.log || d.log.length === 0) {
    list.innerHTML = '<div class="empty-log">ğŸ“‹ ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”.<br>ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« í™•ì¸ì„ í•´ì£¼ì„¸ìš”!</div>';
    return;
  }

  list.innerHTML = d.log.map(item => {
    const t = new Date(item.time);
    const mo = (t.getMonth()+1).toString().padStart(2,'0');
    const dd = t.getDate().toString().padStart(2,'0');
    const hh = t.getHours().toString().padStart(2,'0');
    const mm = t.getMinutes().toString().padStart(2,'0');
    return `
      <div class="log-item">
        <div class="log-dot ${item.type === 'missed' ? 'missed' : ''}"></div>
        <div>
          <div class="log-text">${item.type === 'missed' ? 'âš ï¸ í™•ì¸ ë¯¸ì™„ë£Œ' : 'ğŸ’š í™•ì¸ ì™„ë£Œ'}</div>
          <div class="log-time">${mo}ì›” ${dd}ì¼ ${hh}:${mm}</div>
        </div>
      </div>
    `;
  }).join('');
}

// ì´ˆê¸°í™”
function clearAll() {
  if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?')) {
    localStorage.removeItem('alive_data');
    localStorage.removeItem('alive_contacts');
    updateUI();
    alert('ì´ˆê¸°í™”ëì–´ìš”.');
  }
}

// 24ì‹œê°„ ì²´í¬ (1ë¶„ë§ˆë‹¤)
function checkOverdue() {
  const d = getData();
  if (!d.lastCheck) return;
  const elapsed = (new Date() - new Date(d.lastCheck)) / 1000 / 60 / 60;

  if (elapsed >= 24) {
    // ë¬¸ì ë°œì†¡ ì•ˆë‚´ (ì‹¤ì œ SMS API ì—°ë™ í•„ìš”)
    const contacts = JSON.parse(localStorage.getItem('alive_contacts') || '{}');
    const name = contacts.myName || 'ì‚¬ìš©ì';
    const msg = `[ë‚˜ì‚´ì•„ìˆì–´ ì•±] ${name}ë‹˜ì´ 24ì‹œê°„ ì´ìƒ í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.`;

    // SMS ë§í¬ë¡œ ë°œì†¡ ìœ ë„
    const phones = [contacts.c1, contacts.c2, contacts.c3, contacts.c4, contacts.c5]
      .filter(c => c && c.phone)
      .map(c => c.phone);

    if (phones.length > 0 && !localStorage.getItem('alert_sent_' + d.lastCheck)) {
      localStorage.setItem('alert_sent_' + d.lastCheck, '1');
      const smsUrl = 'sms:' + phones[0] + '?body=' + encodeURIComponent(msg);
      if (confirm('24ì‹œê°„ì´ ì§€ë‚¬ì–´ìš”!\në³´í˜¸ìì—ê²Œ ë¬¸ìë¥¼ ë³´ë‚¼ê¹Œìš”?\n\n' + msg)) {
        window.location.href = smsUrl;
      }
    }
  }
}

// ì‹œì‘
updateUI();
setInterval(() => { updateUI(); checkOverdue(); }, 60000);
</script>
</body>
</html>
